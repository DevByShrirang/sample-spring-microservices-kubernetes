pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                echo "üì• Checking out code from branch: ${env.BRANCH_NAME}"
                checkout scm
            }
        }

        stage('Detect Changed Microservices') {
            steps {
                script {
                    echo "üîç Checking which microservices changed..."

                    changedServices = sh(
                        script: "git diff --name-only HEAD~1 | cut -d'/' -f1 | sort -u || true",
                        returnStdout: true
                    ).trim().split('\n')

                    if (changedServices[0] == '') {
                        echo "‚úÖ No microservice changes detected."
                        changedServices = []
                    } else {
                        echo "üîç Changed microservices: ${changedServices}"
                    }
                }
            }
        }
    }
}

